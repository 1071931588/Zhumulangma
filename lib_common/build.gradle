apply plugin: 'com.android.library'
apply plugin: 'org.greenrobot.greendao'

import com.android.build.gradle.LibraryPlugin
import org.aspectj.bridge.IMessage
import org.aspectj.bridge.MessageHandler
import org.aspectj.tools.ajc.Main
android {
    compileSdkVersion rootProject.ext.android.compileSdkVersion

    defaultConfig {
        minSdkVersion rootProject.ext.android.minSdkVersion
        targetSdkVersion rootProject.ext.android.targetSdkVersion
        versionCode rootProject.ext.android.versionCode
        versionName rootProject.ext.android.versionName
        //阿里路由框架配置
        javaCompileOptions {
            annotationProcessorOptions {
                arguments = [AROUTER_MODULE_NAME: project.getName()]
            }
        }
    }

    buildTypes {
        debug {
            buildConfigField "boolean", 'IS_DEBUG', 'true'
        }
        release {
            buildConfigField "boolean", 'IS_DEBUG', 'false'
        }
    }
    sourceSets {
        main {
            assets.srcDirs = ['src/main/assets', 'src/main/assets/']
            jniLibs.srcDirs = ['libs']
        }
    }
    compileOptions {
        sourceCompatibility JavaVersion.VERSION_1_8
        targetCompatibility JavaVersion.VERSION_1_8
    }
}
dependencies {
    api fileTree(include: ['*.jar'], dir: 'libs')
    annotationProcessor rootProject.ext.dependencies["arouter-compiler"]
    api rootProject.ext.support["design"]
    api rootProject.ext.support["support-v4"]
    api rootProject.ext.support["appcompat-v7"]
    api rootProject.ext.support["constraint-layout"]
    api rootProject.ext.support["recyclerview-v7"]
    api rootProject.ext.support["junit"]
    api rootProject.ext.support["runner"]
    api rootProject.ext.support["espresso-core"]
    api rootProject.ext.dependencies["arouter-api"]
    api rootProject.ext.dependencies["rxjava"]
    api rootProject.ext.dependencies["rxandroid"]
    api rootProject.ext.dependencies["eventbus"]
    api(rootProject.ext.dependencies["glide"]) {
        exclude group: 'com.android.support'
    }
    implementation 'com.android.support.constraint:constraint-layout:1.1.3'
    annotationProcessor rootProject.ext.dependencies["glide-compiler"]
    api rootProject.ext.dependencies["lifecycle-extensions"]
    annotationProcessor rootProject.ext.dependencies["lifecycle-compiler"]
    //network
    api rootProject.ext.dependencies["okhttp"]
    api rootProject.ext.dependencies["retrofit"]
    api rootProject.ext.dependencies["converter-gson"]
    api rootProject.ext.dependencies["adapter-rxjava"]
    api rootProject.ext.dependencies["logging-interceptor"]
    //json解析
    api rootProject.ext.dependencies["gson"]
    //rx管理View的生命周期
    api(rootProject.ext.dependencies["rxlifecycle"]) {
        exclude group: 'com.android.support'
    }
    api(rootProject.ext.dependencies["rxlifecycle-components"]) {
        exclude group: 'com.android.support'
    }
    api rootProject.ext.dependencies["rxjava"]
    api rootProject.ext.dependencies["rxandroid"]
    //rx权限请求
    api(rootProject.ext.dependencies["rxpermissions"]) {
        exclude group: 'com.android.support'
    }
    api rootProject.ext.dependencies["utilcode"]
    api rootProject.ext.dependencies["loadsir"]
    api rootProject.ext.dependencies["titlebar"]
    api rootProject.ext.dependencies["fragmentation"]
    api rootProject.ext.dependencies["fragmentation-swipeback"]
    api rootProject.ext.dependencies["lottie"]
    api rootProject.ext.dependencies["autosize"]
    api rootProject.ext.dependencies["SmartRefreshLayout"]
    api rootProject.ext.dependencies["circleimageview"]
    api rootProject.ext.dependencies["indicatorseekbar"]
    api rootProject.ext.dependencies["BaseRecyclerViewAdapterHelper"]
    api rootProject.ext.dependencies["multidex"]
    api rootProject.ext.dependencies["picture_library"]
    api rootProject.ext.dependencies["PickerView"]
    api rootProject.ext.dependencies["rxbinding"]

    debugApi rootProject.ext.dependencies["leakcanary"]
    releaseApi rootProject.ext.dependencies["leakcanary-no-op"]
    api rootProject.ext.dependencies["AVLoading"]
    api rootProject.ext.dependencies["EasyNavigation"]
    api rootProject.ext.dependencies["MagicIndicator"]
    api rootProject.ext.dependencies["banner"]
    api rootProject.ext.dependencies["ratingbar"]
    api rootProject.ext.dependencies["labelview"]
    api rootProject.ext.dependencies["FlowLayout"]
    api rootProject.ext.dependencies["greendao"]
    api rootProject.ext.dependencies["MarqueeView"]
    api rootProject.ext.dependencies["xpopup"]
    api rootProject.ext.dependencies["toast"]
    api rootProject.ext.dependencies["bga-qrcode-zxing"]
    api rootProject.ext.dependencies["agentwebX5"]
    api rootProject.ext.dependencies["roundedimageview"]
    api rootProject.ext.dependencies["aspectjrt"]
    api rootProject.ext.dependencies["okaspectjrt"]
    annotationProcessor rootProject.ext.dependencies["okaspectjrt-compiler"]
    api rootProject.ext.dependencies["customactivityoncrash"]

    api 'com.amap.api:location:latest.integration'
    api 'com.tencent.bugly:crashreport_upgrade:latest.release'
    api 'com.tencent.tinker:tinker-android-lib:1.9.9'
    api files('libs/TingPhoneOpenSDK_7.0.8.jar')
    api files('libs/XmlyOAuth2SDK_V1.11.jar')
    api files('libs/XmDownload_1.7.jar')
    api files('libs/Msc.jar')
    api files('libs/umeng-common-2.1.0.jar')
    api files('libs/umeng-share-core-6.9.6.jar')
    api files('libs/umeng-shareboard-widget-6.9.6.jar')
    api files('libs/umeng-sharetool-6.9.6.jar')
    api files('libs/umeng-share-QQ-simplify-6.9.6.jar')
    api files('libs/umeng-share-sina-simplify-6.9.6.jar')
    api files('libs/umeng-share-wechat-simplify-6.9.6.jar')
    api files('libs/tbs_sdk_thirdapp_v4.3.0.1148_43697_sharewithdownloadwithfile_withoutGame_obfs_20190805_175505.jar')
    api files('libs/alipaySdk-20180601.jar')
}
greendao {
    //数据库的schema版本，也可以理解为数据库版本号
    schemaVersion 1
    //设置DaoMaster、DaoSession、Dao包名，也就是要放置这些类的包的全路径。
    daoPackage 'com.gykj.zhumulangma.common.dao'
    //设置DaoMaster、DaoSession、Dao目录
    targetGenDir 'src/main/java'
}


android.libraryVariants.all { variant ->
    LibraryPlugin plugin = project.plugins.getPlugin(LibraryPlugin)
    JavaCompile javaCompile = variant.javaCompile
    javaCompile.doLast {
        String[] args = ["-showWeaveInfo",
                         "-1.5",
                         "-inpath", javaCompile.destinationDir.toString(),
                         "-aspectpath", javaCompile.classpath.asPath,
                         "-d", javaCompile.destinationDir.toString(),
                         "-classpath", javaCompile.classpath.asPath,
                         "-bootclasspath", plugin.project.android.bootClasspath.join(
                File.pathSeparator)]

        MessageHandler handler = new MessageHandler(true);
        new Main().run(args, handler)

        def log = project.logger
        for (IMessage message : handler.getMessages(null, true)) {
            switch (message.getKind()) {
                case IMessage.ABORT:
                case IMessage.ERROR:
                case IMessage.FAIL:
                    log.error message.message, message.thrown
                    break;
                case IMessage.WARNING:
                case IMessage.INFO:
                    log.info message.message, message.thrown
                    break;
                case IMessage.DEBUG:
                    log.debug message.message, message.thrown
                    break;
            }
        }
    }
}
